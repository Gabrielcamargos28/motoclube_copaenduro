@model List<MotoClubeCerrado.Models.Inscrito>
@{
    ViewData["Title"] = "Inscritos - " + ViewBag.Etapa?.Nome;
    Layout = "_AdminLayout";
    var etapa = ViewBag.Etapa as MotoClubeCerrado.Models.Etapa;
}

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span><i class="fas fa-users"></i> Inscritos - @etapa?.Nome</span>
        <a href="@Url.Action("Etapas")" class="btn btn-light btn-sm">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
    </div>
    <div class="card-body">
        <div class="mb-3">
            <strong>Total de Inscritos:</strong> @Model.Count |
            <strong>Pagos:</strong> @Model.Count(i => i.Pagamento == 1) |
            <strong>Pendentes:</strong> @Model.Count(i => i.Pagamento == 0)
        </div>

        <div class="table-responsive">
            <table class="table table-hover table-sm">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Categoria</th>
                        <th>Cidade/UF</th>
                        <th>Email</th>
                        <th>Telefone</th>
                        <th class="text-center">Valor</th>
                        <th class="text-center">Pagamento</th>
                        <th class="text-center">Ação</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var inscrito in Model)
                    {
                        <tr>
                            <td>@inscrito.Nome</td>
                            <td>@inscrito.Categoria?.Nome</td>
                            <td>@inscrito.Cidade/@inscrito.Uf</td>
                            <td><small>@inscrito.Email</small></td>
                            <td><small>@inscrito.Telefone</small></td>
                            <td class="text-center">R$ @inscrito.Valor.ToString("F2")</td>
                            <td class="text-center">
                                @if (inscrito.Pagamento == 1)
                                {
                                    <span class="badge bg-success">Confirmado</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning">Pendente</span>
                                }
                            </td>
                            <td class="text-center">
                                <button type="button" class="btn btn-sm @(inscrito.Pagamento == 1 ? "btn-warning" : "btn-success")"
                                        onclick="togglePagamento(@inscrito.Id)">
                                    <i class="fas fa-@(inscrito.Pagamento == 1 ? "times" : "check")"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function togglePagamento(id) {
            if (confirm('Deseja alterar o status de pagamento deste inscrito?')) {
                $.ajax({
                    url: '@Url.Action("TogglePagamento")',
                    type: 'POST',
                    data: {
                        id: id,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            location.reload();
                        } else {
                            alert('Erro ao atualizar status de pagamento');
                        }
                    }
                });
            }
        }
    </script>
}

<form method="post" style="display:none;">
    @Html.AntiForgeryToken()
</form>
